# 项目配置文件详细说明

本文档详细说明了项目中所有配置文件的作用、配置项和最佳实践。

## 目录

- [包管理配置](#包管理配置)
- [代码质量配置](#代码质量配置)
- [构建工具配置](#构建工具配置)
- [TypeScript 配置](#typescript-配置)
- [样式工具配置](#样式工具配置)
- [Git 配置](#git-配置)
- [编辑器配置](#编辑器配置)

---

## 包管理配置

### 1. `package.json` (根目录)

**作用**: 定义项目的元数据、依赖和脚本命令。

#### 关键配置说明

**scripts**:

- `lint`: 运行 ESLint 并自动修复错误
- `lint:check`: 仅检查 ESLint 错误，不修复
- `format`: 使用 Prettier 格式化所有代码文件
- `format:check`: 检查代码格式是否符合 Prettier 规范
- `type-check`: 运行 TypeScript 类型检查
- `start:vite-vue`: 启动 vite-vue 项目

**packageManager**: `pnpm@10.19.0`

- 固定 pnpm 版本，确保团队使用相同的包管理器版本

**dependencies**: 生产依赖

- `vue`: Vue 3 框架
- `vue-router`: Vue 路由
- `pinia`: 状态管理
- `dayjs`: 日期处理库
- `lodash-es`: 工具函数库（ESM 版本）
- `utils`: workspace 包，本地工具函数

**devDependencies**: 开发依赖

- `vite`: 构建工具
- `@vitejs/plugin-vue`: Vite 的 Vue 插件
- `@vitejs/plugin-legacy`: 旧浏览器支持插件
- `typescript`: TypeScript 编译器
- `vue-tsc`: Vue 的 TypeScript 类型检查器
- `eslint` 相关: 代码检查工具
- `prettier`: 代码格式化工具
- `unocss`: 原子化 CSS 框架
- `sass`: CSS 预处理器

### 2. `pnpm-workspace.yaml`

**作用**: 定义 pnpm workspace 的工作区结构。

```yaml
packages:
  - packages/* # 共享包目录
  - projects/* # 项目目录
```

**说明**:

- 定义了 monorepo 的工作区范围
- `packages/*`: 存放可复用的共享包
- `projects/*`: 存放具体的应用项目

### 3. `.npmrc`

**作用**: 配置 npm/pnpm 的行为。

```
link-workspace-packages = true
prefer-workspace-packages = true
```

**配置说明**:

- `link-workspace-packages = true`: 自动链接 workspace 中的包
- `prefer-workspace-packages = true`: 优先使用 workspace 中的包版本

---

## 代码质量配置

### 4. `eslint.config.js`

**作用**: ESLint 代码检查配置，使用 ESLint 9+ 的 flat config 格式。

#### 配置结构

**忽略文件**:

- `dist/`, `node_modules/`, `.vscode/` 等构建和工具目录
- `pnpm-lock.yaml`, `.DS_Store` 等系统文件

**JavaScript 基础配置**:

- 使用 `@eslint/js` 的推荐配置

**TypeScript 配置**:

- 使用 `typescript-eslint` 的推荐配置
- 支持 TypeScript 类型检查

**Vue 配置**:

- 使用 `vue3-recommended` 规则集
- 自定义规则:
  - `vue/multi-word-component-names: 'off'`: 允许单字组件名
  - `vue/no-v-html: 'warn'`: v-html 使用警告
  - `vue/require-default-prop: 'off'`: 不要求 props 默认值
  - `vue/require-explicit-emits: 'warn'`: emit 需要明确声明
  - `vue/html-self-closing: 'error'`: HTML 标签必须自闭合

**通用规则**:

- `@typescript-eslint/no-unused-vars`: 未使用变量警告（忽略 `_` 开头的变量）
- `@typescript-eslint/no-explicit-any`: 禁止使用 `any` 类型（警告级别）
- `no-console: 'off'`: 允许使用 console

**Prettier 集成**:

- 最后应用 `eslint-config-prettier`，禁用与 Prettier 冲突的规则

### 5. `.prettierrc`

**作用**: Prettier 代码格式化配置。

#### 配置项说明

- `semi: true`: 使用分号
- `singleQuote: true`: 使用单引号
- `tabWidth: 2`: 缩进 2 个空格
- `useTabs: false`: 使用空格而非 Tab
- `trailingComma: "es5"`: 尾随逗号（ES5 兼容）
- `printWidth: 100`: 每行最大 100 字符
- `arrowParens: "avoid"`: 箭头函数单参数时省略括号
- `endOfLine: "lf"`: 使用 LF 换行符（Unix 风格）
- `bracketSpacing: true`: 对象字面量大括号内有空格
- `vueIndentScriptAndStyle: false`: Vue 文件中的 script 和 style 不缩进
- `htmlWhitespaceSensitivity: "ignore"`: HTML 空白符敏感度忽略

### 6. `.prettierignore`

**作用**: 指定 Prettier 忽略的文件和目录。

**忽略内容**:

- `node_modules/`: 依赖目录
- `dist/`: 构建输出目录
- `coverage/`: 测试覆盖率报告
- `pnpm-lock.yaml`: 锁文件
- `*.min.js`: 压缩后的 JS 文件
- `.DS_Store`: macOS 系统文件
- `.vscode/`: VS Code 配置目录

---

## 构建工具配置

### 7. `vite.config.base.ts`

**作用**: Vite 构建工具的共享基础配置。

#### 插件配置

**@vitejs/plugin-vue**:

- 支持 Vue 3 单文件组件

**unplugin-vue-components**:

- 自动导入组件
- 使用 `NaiveUiResolver` 自动导入 Naive UI 组件

**unocss/vite**:

- UnoCSS 原子化 CSS 框架集成

**@vitejs/plugin-legacy**:

- 支持旧浏览器
- 转换现代语法（包括可选链 `?.` 和空值合并 `??`）
- 目标浏览器: `['defaults', 'not IE 11']`
- `modernPolyfills: true`: 启用现代 polyfills

#### 路径别名

- `@`: 指向 `./src`（在子项目中会被覆盖）
- `utils`: 指向 `packages/utils/index.ts`
- `base`: 指向 `packages/base/index.ts`

#### 构建配置

**target**:

- `['es2020', 'edge88', 'firefox78', 'chrome87', 'safari14']`
- 支持可选链和空值合并的浏览器版本

**esbuild**:

- `target: 'es2020'`: ES2020 原生支持 `?.` 和 `??`
- 如需支持更旧浏览器，可设置为 `'es2015'` 或 `'es5'`

### 8. `projects/vite-vue/vite.config.ts`

**作用**: vite-vue 项目的特定配置。

#### 配置说明

- 继承 `baseViteConfig` 的所有配置
- 覆盖 `@` 别名，指向项目自身的 `./src` 目录
- 可以在此添加项目特定的配置

---

## TypeScript 配置

### 9. `tsconfig.base.json`

**作用**: TypeScript 的基础配置，供所有子项目继承。

#### 编译器选项

**基础配置**:

- `target: "ES2020"`: 编译目标为 ES2020
- `module: "ESNext"`: 使用最新的 ES 模块系统
- `lib: ["ES2020", "DOM", "DOM.Iterable"]`: 包含的类型定义

**Bundler 模式**:

- `moduleResolution: "bundler"`: 使用 bundler 模块解析
- `allowImportingTsExtensions: true`: 允许导入 `.ts` 扩展名
- `resolveJsonModule: true`: 支持导入 JSON 文件
- `isolatedModules: true`: 确保每个文件可以独立编译
- `noEmit: true`: 不生成输出文件（由 Vite 处理）
- `jsx: "preserve"`: 保留 JSX（由 Vue 处理）

**严格检查**:

- `strict: true`: 启用所有严格类型检查
- `noUnusedLocals: true`: 未使用的局部变量报错
- `noUnusedParameters: true`: 未使用的参数报错
- `noFallthroughCasesInSwitch: true`: switch 语句必须有 break
- `noUncheckedSideEffectImports: true`: 检查副作用导入

### 10. `projects/vite-vue/tsconfig.json`

**作用**: vite-vue 项目的 TypeScript 主配置。

**配置说明**:

- 使用项目引用（Project References）
- 引用 `tsconfig.app.json` 和 `tsconfig.node.json`

### 11. `projects/vite-vue/tsconfig.app.json`

**作用**: 应用代码的 TypeScript 配置。

#### 配置说明

**继承**:

- `../../tsconfig.base.json`: 基础配置
- `@vue/tsconfig/tsconfig.dom.json`: Vue 官方 DOM 配置

**特定配置**:

- `composite: true`: 启用项目引用
- `types: ["vite/client"]`: 包含 Vite 客户端类型
- `baseUrl: "."`: 基础路径
- `paths`: 路径映射
  - `@/*`: 指向 `./src/*`
  - `utils`: 指向 `../../packages/utils/src`
  - `base`: 指向 `../../packages/base/src`

**包含文件**:

- `src/**/*.ts`, `src/**/*.tsx`, `src/**/*.vue`

### 12. `projects/vite-vue/tsconfig.node.json`

**作用**: Node.js 环境（如 vite.config.ts）的 TypeScript 配置。

#### 配置说明

**继承**:

- `../../tsconfig.base.json`: 基础配置

**特定配置**:

- `target: "ES2023"`: Node.js 环境使用更新的 ES 版本
- `lib: ["ES2023"]`: Node.js 类型定义
- `types: ["node"]`: Node.js 类型
- `paths`: 与 app 配置相同的路径映射

**包含文件**:

- `vite.config.ts`, `../../vite.config.base.ts`

---

## 样式工具配置

### 13. `uno.config.ts`

**作用**: UnoCSS 原子化 CSS 框架配置。

#### 配置说明

**transformers**:

- `transformerDirectives()`: 支持 `@apply` 指令
  - 允许在 CSS 中使用 `@apply` 应用 UnoCSS 工具类

**使用示例**:

```css
.custom-class {
  @apply pl-20px text-red;
}
```

---

## Git 配置

### 14. `.gitattributes`

**作用**: 统一 Git 仓库中的文件换行符和文本处理方式。

#### 配置说明

**默认规则**:

- `* text=auto eol=lf`: 所有文件自动检测文本，统一使用 LF 换行符

**文本文件**:

- 明确指定各种文本文件类型使用 LF
- 包括: `.js`, `.ts`, `.vue`, `.json`, `.css`, `.scss`, `.md` 等

**二进制文件**:

- 标记为 `binary`，Git 不进行换行符转换
- 包括: 图片、字体、压缩包、可执行文件等

**特殊文件**:

- `.bat`, `.cmd`: Windows 脚本使用 CRLF
- 配置文件: 确保使用 LF

**作用**:

- 避免跨平台换行符冲突
- 统一团队代码风格
- 与 `.editorconfig` 配置保持一致

### 15. `.gitignore`

**作用**: 指定 Git 忽略的文件和目录。

#### 忽略内容分类

**构建输出**:

- `dist/`: 构建产物目录
- `*.tsbuildinfo`: TypeScript 构建信息

**依赖和锁文件**:

- `node_modules/`: 依赖目录
- `pnpm-lock.yaml`: pnpm 锁文件（通常应该提交，但这里被忽略）

**环境变量**:

- `.env*`: 所有环境变量文件

**工具配置**:

- `.vscode/`: VS Code 配置
- `.DS_Store`: macOS 系统文件

**缓存文件**:

- `.eslintcache`: ESLint 缓存
- `.prettiercache`: Prettier 缓存

---

## 编辑器配置

### 16. `.editorconfig`

**作用**: 统一不同编辑器和 IDE 的代码风格。

#### 配置说明

**全局设置** (`[*]`):

- `charset: utf-8`: 使用 UTF-8 编码
- `end_of_line: lf`: 使用 LF 换行符
- `indent_style: space`: 使用空格缩进
- `indent_size: 2`: 缩进 2 个空格
- `insert_final_newline: true`: 文件末尾插入换行符
- `trim_trailing_whitespace: true`: 删除行尾空白

**Markdown 文件** (`[*.md]`):

- `trim_trailing_whitespace: false`: 保留行尾空白（Markdown 需要）

**YAML 文件** (`[*.{yml,yaml}]`):

- `indent_size: 2`: 缩进 2 个空格

---

## 子项目配置

### 17. `packages/utils/package.json`

**作用**: utils 共享包的配置。

**关键配置**:

- `name: "utils"`: 包名
- `type: "module"`: 使用 ES 模块
- `main: "index.ts"`: 入口文件

### 18. `packages/base/package.json`

**作用**: base 共享包的配置。

**关键配置**:

- `name: "base"`: 包名
- `main: "index.ts"`: 入口文件

### 19. `projects/vite-vue/package.json`

**作用**: vite-vue 项目的配置。

**关键配置**:

- `private: true`: 私有包，不发布到 npm
- `type: "module"`: 使用 ES 模块
- `scripts`:
  - `dev`: 开发模式
  - `build`: 构建生产版本（包含类型检查）
  - `preview`: 预览构建结果

---

## 配置关系图

```
根目录配置 (统一管理)
├── package.json (依赖和脚本)
├── pnpm-workspace.yaml (工作区定义)
├── .npmrc (pnpm 配置)
│
├── 代码质量
│   ├── eslint.config.js (ESLint 配置)
│   ├── .prettierrc (Prettier 配置)
│   └── .prettierignore (Prettier 忽略)
│
├── 构建工具
│   └── vite.config.base.ts (Vite 共享配置)
│
├── TypeScript
│   └── tsconfig.base.json (TS 基础配置)
│
├── 样式工具
│   └── uno.config.ts (UnoCSS 配置)
│
└── Git/编辑器
    ├── .gitattributes (Git 换行符)
    ├── .gitignore (Git 忽略)
    └── .editorconfig (编辑器配置)

子项目配置 (继承根配置)
└── projects/vite-vue/
    ├── vite.config.ts (继承 base + 项目特定)
    ├── tsconfig.json (项目引用)
    ├── tsconfig.app.json (继承 base + Vue 配置)
    └── tsconfig.node.json (继承 base + Node 配置)
```

---

## 最佳实践

### 1. 配置继承原则

- **根目录配置**: 统一管理，所有子项目继承
- **子项目配置**: 只覆盖必要的特定配置
- **避免重复**: 相同配置只在一个地方定义

### 2. 路径别名

- 使用路径别名简化导入: `@/`, `utils`, `base`
- 在 `tsconfig` 和 `vite.config` 中保持一致

### 3. 代码规范

- ESLint 负责代码质量检查
- Prettier 负责代码格式化
- 两者配合使用，避免冲突

### 4. 浏览器兼容性

- 默认支持现代浏览器（ES2020+）
- 需要旧浏览器支持时，启用 `@vitejs/plugin-legacy`

### 5. 换行符统一

- 所有配置文件统一使用 LF
- `.gitattributes` 和 `.editorconfig` 保持一致

---

## 常见问题

### Q: 如何添加新的 ESLint 规则？

A: 在 `eslint.config.js` 的 `rules` 对象中添加新规则。

### Q: 如何修改代码格式化规则？

A: 修改 `.prettierrc` 文件中的配置项。

### Q: 如何支持更旧的浏览器？

A: 在 `vite.config.base.ts` 中调整 `build.target` 或启用 `legacy` 插件。

### Q: 如何添加新的路径别名？

A: 在 `vite.config.base.ts` 的 `resolve.alias` 和对应的 `tsconfig` 的 `paths` 中添加。

### Q: 子项目如何覆盖根配置？

A: 在子项目的配置文件中使用 `extends` 继承，然后覆盖特定选项。

---

## 更新日志

- 2024: 初始配置完成
  - 配置 ESLint、Prettier、TypeScript、Vite
  - 统一代码规范和构建流程
  - 添加旧浏览器支持（legacy 插件）
