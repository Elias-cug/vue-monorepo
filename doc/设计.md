## 路由设计

1. 怎么用的问题

projects/pages/index.ts 文件提供所有的路由信息。剩下的交给 base。

```ts
{
  path: '/:appid/dashboard', // 用 appid 一个项目多个 应用的场景，要用 appid 区分
  name: 'Dashboard',
  redirect: "", // 可选
  component: () => import('@/pages/Dashboard/index.vue'),
  meta: {
    layout: "basic | blank | header",
    title: "", // 菜单名称
    icon: '', // 菜单图标
    defaultIndex: '', // 高亮菜单
    /**
     * 是否显示到菜单, 默认 false
     */
    hidden: false,
    /**
     * 是否缓存
     */
    keepalive: false,
    /**
     * 是否需要权限，
     * true 需要，后端不返回不注册这个路由，
     * false 不需要，无论后端返回都注册
     */
    auth: true,
    /**
     * 是否多 tab
     * 默认 false
     * true：以 fullPath 为添加依据
     * false：以 path 为添加依据
     */
    multiTab: false
  }
}

```

- 图标怎么设置的问题
  所有 app 统一使用 svg 图标，将 svg 存储的文件名放到 icon 字段；
  建议菜单 icon 放到本项目 src/assets/svg/menus 下
  建议菜单 icon 命名，menu-[菜单名小写]

2. 流程

引入路由，注册一部分固定路由 --> 登录进去 app --> 路由守卫 --> 验证 token --> 获取用户信息/获取菜单 --> 根据菜单动态注册路由 --> 缓存到 pinia --> 切换路由 --> 检查pinia 的权限 --> 进入切换页面

- 权限验证怎么剥离，好适应不同的权限验证方式？

- routes 和 menus 的设计？

routes 提供可可被注册的路由，包括需要权限的动态路由和不需要权限的固定路由；menus 提供菜单配置，也就是需要权限的菜单，提供给 sider 展示。

第一步：vue 初始化 router，注册一部分固定路由

```ts
// @base/src/router/index.ts
const router = createRouter({
  history: createWebHistory(),
  routes: [...constantRoutes],
});

// @projects/vite-vue/src/main.ts
app.use(router);
```

第二步：登录成功后，获取用户信息/获取菜单

```ts
// 1. 获取菜单信息

/**
 * 2. 处理菜单信息
 * a. 处理生成一份 sider 需要的 menus 格式，字段对应，有 sider 需要的所有信息，所有资源管理/菜单下的信息都要包含。树状的结构。--》渲染菜单
 * b. 处理生成一份 router 需要的 routes 格式，字段对应，有 router 需要的所有信息。扁平的结构。--》动态注册路由
 *
 */
```

第三步：根据菜单动态注册路由

- authStore 存哪些东西？

- tab 和 menu 怎么联动？

Tab 的更新应该发生在路由变化时（包括 path/params/query/meta 任何变化）。

核心触发条件：在 router.afterEach 里处理 Tab 的所有逻辑

这是最推荐的方式，因为：

每次路由跳转都会走这里（包括 params、query 变化）

切换 tab 时也会走

meta 变化触发 watch

- tab 缓存更新策略是什么？

- tab 结构是什么，用什么来确定唯一性?

用 fullPath 来作为 key。fullPath 包含 path + query + hash。

```js
{
  key: route.fullPath,
  title: route.meta.title,
  path: route.path,
  query: route.query,
  closable: true
}
```

- tab 自定义名称怎么处理？

```js
// page.vue
import { useRoute } from 'vue-router';
const route = useRoute();
route.meta.tabTitle = `用户：${user.value.name}`;

//tab.vue
watch(
  () => route.meta.tabTitle,
  newTitle => {
    const tab = tabs.find(t => t.key === route.fullPath);
    if (tab && newTitle) tab.title = newTitle;
  }
);
```

- 一个 route 对应多个 tab 怎么处理？

用 fullPath 作为唯一，这样一个 path 可以对应多个 tab
